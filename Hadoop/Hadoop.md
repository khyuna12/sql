## Hadoop

### Hadoop Ecosystem
1. linux
2. Java(system)
3. Spark(Data Framework)
  - 스칼라: 더 빠름
  - 파이썬

#### HDFS

- **분산 파일 시스템**: 네트워크로 연결된 여러 머신의 스토리지 관리하는 파일 시스템

- 스트리밍 방식의 데이터 접근
- 높은 데이터 처리량 제공에 최적화: 응답시간 희생
  - 빠른 응답시간을 원한다면 HBASE가 대안
- 저장할 수 있는 파일 수는 네임노드의 메모리 용량에 좌우
- 단일 라이터: 파일에서 임의 위치에 있는 내용을 수정하는 것은 허용하지 않음
- **블록**: 한 번에 읽고 쓸 수 있는 데이터의 최대량
  - 파일 시스템 블록의 크기는 보통 수 킬로바이트, 디스크 블록의 크기는 512바이트
  - 사용자는 파일의 크기와 상관없이 파일을 읽고 쓸 수 있음
  - HDFS의 파일은 단일 디스크를 위한 파일 시스템처럼 특정 블록 크기의 chunk로 쪼개지고 각 chunk는 독립적으로 저장
  - 블록 크기보다 작은 데이터의 경우 전체 블록크기에 해당하는 하위 디스크를 모두 점유하지는 않음

- 네임노드와 데이터노드 + HDFS 클라이언트
  - HDFS 클러스터는 마스터-워커 패턴으로 동작(마스터: 하나의 네임노드, 워커: 여러개의 데이터 노드)
  - 네임노드
    - 파일시스템의 네임스페이스 관리
    - 파일시스템 트리와 그 트리에 포함된 모든 파일과 디렉터리에 대한 메타데이터 유지
    - 파일에 속한 모든 블록이 어느 데이터노드에 있는지 파악(위치 정보는 디스크에 영속적으로 저장X)
  - 데이터 노드
    - 파일 시스템의 실질적인 일꾼
    - 클라이언트나 네임노드의 요청이 있을 때 블록을 저장하고 탐색, 저장하고 있는 블록의 목록을 주기적으로 네임노드에 보고

#### MapReduce

- 맵 함수
  - 단지 데이터의 준비 단계로, 리듀스 함수를 위해 데이터 제공
  - 잘못된 레코드 거르기
- 각 행맵 함수의 출력이 리듀스 함수의 입력으로 보내지는 과정은 맵리듀스 프레임워크에 의해 처리
- 리듀스 함수
  - 리스트 전체 반복하여 최고 측정값 추출

- 단일 리듀스 태스크의 맵리듀스 데이터 흐름
![Alt text](image.png)

- 맵 리듀스 원리
  - Split
  - `Map()`
  - 셔플
  - `Reduce()`
  - output 저장 

<br>

#### 빅데이터 수집 기술
- **Sqoop** by 아파치
  - RDBMS와 HDFS간의 데이터 연동
  - 양방향: Import & Export
  - 다양한 DB로부터의 자료 이동 지원

- **Flume** by Cloudera
  - 분산 환경에서 방대한 양의 이벤트 로그 수집 후 전송
  - 오픈 소스 로그 수집 소프트웨어
  - 다양한 로그 데이터 수집 및 모니터링이 가능하며 실시간 전송을 지원
  - 자바로 구현되어 있어 다양한 운영체제에 설치가 가능
  - 장애에 쉽게 대처 가능
  - 아키텍처
    - 에이전트: 소스, 채널, 싱크로 구성
    - 개별 에이전트의 연결이 가능
  - 구성요소
    - 소스: 지정한 소스를 통해서 이벤트를 받아 채널로 전달
    - 채널: 일종의 큐로서 이벤트를 임시로 보관
    - 싱크: 채널에서 이벤트를 읽어와 출력 대상에 씀

- **Kafka** by Linkedin
  - 분산 시스템에서 메시지 전송 및 수집
  - 웹 사이트, 어플리케이션, 센서 등에 취합한 데이터를 스트림 파이프라인을 통해 실시간으로 관리하고 보내기 위한 분산 스트리밍 플랫폼
  - 데이터를 생성하는 어플리케이션과 데이터를 소비하는 어플리케이션 간의 중재자 역할 -> 데이터의 전송 제어, 처리, 관리 역할
  - 어플리케이션과 서버 간의 비동기 데이터 교환을 용이하게 함
  - 확장성(scale-out), 고가용성(High Availability)
  - 구성
    - **Cluster**: 여러 대의 컴퓨터들이 연결되어 하나의 시스템처럼 동작하는 컴퓨터들의 집합
    - **Producer**: 특정 Topic의 메시지를 생성한 뒤 해당 메시지를 Broker에 전달(전달자)
    - **Consumer**: 분류하여 쌓아놓은 Topic별로 해당 Topic 구독하는 consumer들이 메시지를 가져가서 처리(소비자)
    - **Broker**: Topic을 기준으로 메시지 관리(중재자)
    - **Topic**: 보내는 메시지를 구분하기 위한 카테고리화
    - **Partition**: 토픽을 구성하는 데이터 저장소로서 수평확장이 가능한 형태
  
<br>

#### 빅데이터 저장 기술
- **분산 파일 시스템**
  - **HDFS**: 대표적인 오픈소스 분산파일시스템
    - 대용량 파일의 스트리밍 읽기와 쓰기에 뛰어난 성능
    - 단일 중앙 서버에 저장된 파일시스템 메타데이터는 블록 데이터의 디렉터리 역할
  - **Hive**: HDFS기반의 DataWarehouse
    - SQL 쿼리를 MapReduce 작업을 위해 컴파일하고 클러스터에서 실행되게 함
    - RDBMS와 차이점
      - 작은 데이터일 경우 응답 속도가 느림
      - 레코드 단위 insert, update, delete 지원하지 않음
      - 트랜잭션을 지원하지 않음
      - 통계정보 바로 확인 불가
      - 입력값 오류 바로 확인 불가
    - 데이터 모델
      - 테이블
      - 파티션
        - 테이블은 하나 이상의 파티션 키를 가짐
        - 데이터 접근을 위한 테이블 구조이 최적화(인덱스)
      - 버킷
        - 파티션의 데이터는 특정 해쉬 함수에 의해서 버킷으로 분할
        - 특정 범위의 해쉬 파티션(샘플링)
    - 메타스토어
    - 물리적 레이아웃
  - S3: 아마존의 클라우드 기반 분산 스토리지 서비스

- **NOSQL**
  - **HBase**: HDFS기반의 NOSQL
    - 데이터 모델
      - 테이블: 로우들의 집합, 로우키, 1개 이상의 컬럼패밀리
      - 로우키: 임의의 바이트열, 사전순으로 내림차순 정렬
      - 컬럼패밀리: 컬럼들의 그룹, 컬럼패밀리의 멤버컬럼은 같은 접두사
      - 셀: 로우키&컬럼&버전이 명시된 튜플, 값은 임의의 바이트열이며 Timestamp가 있음
  - Cassandra: ACID 속성을 유지한 분산 데이터베이스
  - 몽고DB: DB의 수평 확장 및 범위 질의 지원, 자체 맵리듀스


